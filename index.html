<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à 58mm</title>
    <style>
        :root { --primary: #2563eb; --secondary: #64748b; --success: #22c55e; }
        body { font-family: 'Tahoma', sans-serif; background-color: #f1f5f9; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 400px; padding: 25px; border-radius: 15px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin-bottom: 20px; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 14px; margin-bottom: 5px; color: var(--secondary); }
        input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        .item-list { border-top: 2px dashed #e2e8f0; margin-top: 20px; padding-top: 20px; }
        .total-display { font-size: 20px; font-weight: bold; text-align: right; color: #1e293b; margin: 15px 0; }
        
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-add { background: #e2e8f0; color: #1e293b; margin-bottom: 10px; }
        .btn-print { background: var(--success); color: white; }
        button:active { transform: scale(0.98); }

        .receipt-preview { background: #fff; border: 1px solid #ddd; padding: 10px; font-family: monospace; font-size: 12px; margin-top: 20px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</h2>
    
    <div class="form-group">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label>
        <input type="text" id="shopName" value="‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô">
    </div>

    <div id="itemsContainer">
        <div class="form-group">
            <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡∏£‡∏≤‡∏Ñ‡∏≤</label>
            <div style="display: flex; gap: 5px;">
                <input type="text" class="item-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" style="flex: 2;">
                <input type="number" class="item-price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" style="flex: 1;" oninput="calculateTotal()">
            </div>
        </div>
    </div>

    <button class="btn-add" onclick="addItem()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>

    <div class="total-display">
        ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: <span id="totalAmount">0.00</span> ‡∏ø
    </div>

    <button class="btn-print" onclick="preparePrint()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>
</div>

<script>
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
    function addItem() {
        const container = document.getElementById('itemsContainer');
        const div = document.createElement('div');
        div.className = 'form-group';
        div.innerHTML = `
            <div style="display: flex; gap: 5px; margin-top: 5px;">
                <input type="text" class="item-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" style="flex: 2;">
                <input type="number" class="item-price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" style="flex: 1;" oninput="calculateTotal()">
            </div>
        `;
        container.appendChild(div);
    }

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°
    function calculateTotal() {
        let total = 0;
        const prices = document.querySelectorAll('.item-price');
        prices.forEach(p => {
            total += parseFloat(p.value) || 0;
        });
        document.getElementById('totalAmount').innerText = total.toFixed(2);
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡πà‡∏≤‡∏ô RawBT
    function preparePrint() {
        const shopName = document.getElementById('shopName').value;
        const names = document.querySelectorAll('.item-name');
        const prices = document.querySelectorAll('.item-price');
        const total = document.getElementById('totalAmount').innerText;
        
        let now = new Date();
        let dateStr = now.toLocaleDateString() + " " + now.toLocaleTimeString();

        // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå 58mm (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 32 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
        let receiptText = "";
        receiptText += `\x1B\x61\x01${shopName}\n`; // ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á
        receiptText += `--------------------------------\n`;
        receiptText += `Date: ${dateStr}\n`;
        receiptText += `--------------------------------\n`;
        
        names.forEach((nameInput, index) => {
            let n = nameInput.value || "Item";
            let p = parseFloat(prices[index].value || 0).toFixed(2);
            // ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ù‡∏±‡πà‡∏á
            let spaceCount = 32 - (n.length + p.length);
            let spaces = " ".repeat(Math.max(1, spaceCount));
            receiptText += `${n}${spaces}${p}\n`;
        });

        receiptText += `--------------------------------\n`;
        receiptText += `\x1B\x61\x02TOTAL: ${total} THB\n`; // ‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤
        receiptText += `\x1B\x61\x01\nTHANK YOU\n\n\n\n`;

        // ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Intent ‡∏Ç‡∏≠‡∏á RawBT
        const rawBTUrl = "intent:#Intent;scheme=rawbt;package=ru.a402nd.rawbtprinter;S.text=" + 
                         encodeURIComponent(receiptText) + ";end;";

        window.location.href = rawBTUrl;
    }
</script>

</body>
</html>
