<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏¢‡∏≥‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Kanit', sans-serif;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .spice-level {
            transition: all 0.2s ease;
        }
        .spice-level:hover {
            transform: scale(1.05);
        }
        .popup-overlay {
            backdrop-filter: blur(5px);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-red-50 min-h-screen">
    <!-- Header -->
    <div class="bg-gradient-to-r from-red-600 to-orange-600 text-white p-6 shadow-lg">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-center mb-2">üçú ‡∏¢‡∏≥‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å</h1>
            <p class="text-center text-red-100">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß ‡∏™‡∏∞‡∏î‡∏ß‡∏Å</p>
            <div class="text-center mt-4">
                <span class="bg-white/20 px-4 py-2 rounded-full text-lg font-semibold">
                    ‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà: <span id="queueNumber">001</span>
                </span>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto p-3 sm:p-6">
        <!-- Menu Items -->
        <div class="mb-6">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 text-center">üõí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            <div class="grid grid-cols-2 gap-3" id="menuItems">
                <!-- Menu items will be generated here -->
            </div>
        </div>

        <!-- Customer Info -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4">
            <h3 class="text-lg sm:text-xl font-semibold text-gray-800 mb-4">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô *</label>
                    <input type="text" id="customerName" class="w-full px-3 py-3 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" required>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2 text-sm sm:text-base">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <input type="text" id="customerNote" class="w-full px-3 py-3 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4">
            <h3 class="text-lg sm:text-xl font-semibold text-gray-800 mb-4">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
            <div id="orderSummary" class="space-y-2 mb-4">
                <p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
            </div>
            <div class="border-t pt-4">
                <div class="flex justify-between items-center text-lg sm:text-xl font-bold text-red-600">
                    <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                    <span id="totalPrice">0 ‡∏ö‡∏≤‡∏ó</span>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center px-2">
            <button id="submitOrder" class="w-full bg-gradient-to-r from-red-600 to-orange-600 text-white px-6 py-4 rounded-xl text-lg font-semibold shadow-lg hover:from-red-700 hover:to-orange-700 active:scale-95 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                üéØ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
            </button>
        </div>
    </div>

    <!-- Options Popup -->
    <div id="optionsPopup" class="fixed inset-0 bg-black/50 popup-overlay hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-4 w-full max-w-sm fade-in max-h-[90vh] overflow-y-auto">
            <div class="text-center mb-4">
                <div class="text-3xl mb-2">üçú</div>
                <h3 id="popupItemName" class="text-lg font-bold text-gray-800"></h3>
                <p id="popupItemPrice" class="text-xl font-bold text-red-600"></p>
            </div>
            
            <!-- Extra Options -->
            <div class="mb-4">
                <h4 class="font-semibold text-gray-700 mb-3 text-sm">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°:</h4>
                <div id="popupExtraOptions" class="space-y-2">
                    <!-- Extra options will be populated here -->
                </div>
            </div>
            
            <!-- Spice Level -->
            <div class="mb-4">
                <h4 class="font-semibold text-gray-700 mb-3 text-sm">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ú‡πá‡∏î:</h4>
                <div id="popupSpiceLevels" class="grid grid-cols-2 gap-2">
                    <!-- Spice levels will be populated here -->
                </div>
            </div>
            
            <!-- Quantity Controls -->
            <div class="flex items-center justify-between mb-6">
                <span class="font-semibold text-gray-700 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</span>
                <div class="flex items-center space-x-4">
                    <button id="popupDecreaseBtn" class="bg-gray-200 active:bg-gray-300 w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl touch-manipulation">-</button>
                    <span id="popupQuantity" class="font-semibold text-2xl w-8 text-center">0</span>
                    <button id="popupIncreaseBtn" class="bg-red-600 active:bg-red-700 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl touch-manipulation">+</button>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="space-y-3">
                <button id="confirmOptionsBtn" class="w-full bg-green-600 text-white py-4 rounded-lg font-semibold active:bg-green-700 transition-colors text-base touch-manipulation">
                    ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                </button>
                <button id="closeOptionsBtn" class="w-full bg-gray-500 text-white py-4 rounded-lg font-semibold active:bg-gray-600 transition-colors text-base touch-manipulation">
                    ‚ùå ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>

    <!-- Success Popup -->
    <div id="successPopup" class="fixed inset-0 bg-black/50 popup-overlay hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto fade-in">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">üéâ</div>
                <h3 class="text-2xl font-bold text-green-600 mb-4">‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <p class="text-lg font-semibold mb-2">‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà: <span id="finalQueueNumber" class="text-red-600"></span></p>
                    <p class="text-gray-600 mb-2">‡∏ä‡∏∑‡πà‡∏≠: <span id="finalCustomerName"></span></p>
                    <p class="text-gray-600 mb-2">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="finalTotalPrice" class="text-red-600 font-semibold"></span></p>
                </div>
            </div>
            
            <div class="mb-6">
                <h4 class="font-semibold text-gray-800 mb-3 text-center">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h4>
                <div id="finalOrderDetails" class="text-sm"></div>
            </div>
            
            <div class="text-center">
                <p class="text-sm text-gray-500 mb-6">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</p>
                <div class="space-y-3">
                    <button id="saveImage" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                        üì∑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô
                    </button>
                    <button id="newOrder" class="w-full bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors">
                        üîÑ ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Menu data
        const menuItems = [
            { id: 1, name: '‡∏¢‡∏≥‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å', price: 30 },
            { id: 2, name: '‡∏¢‡∏≥‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å', price: 50 },
            { id: 3, name: '‡∏¢‡∏≥‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å', price: 90 },
            { id: 4, name: '‡∏¢‡∏≥‡∏´‡∏°‡∏µ‡πà‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å', price: 120 }
        ];

        const extraOptions = [
            { id: 'chicken', name: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏Å‡πà‡∏â‡∏µ‡∏Å', price: 10 },
            { id: 'noodles', name: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏°‡∏µ‡πà‡∏Ç‡∏≤‡∏ß', price: 10 },
            { id: 'sauce', name: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏û‡∏£‡∏¥‡∏Å‡∏Å‡∏≤‡∏Å‡∏´‡∏°‡∏π', price: 15 }
        ];

        const spiceLevels = ['‡πÑ‡∏°‡πà‡πÄ‡∏ú‡πá‡∏î', '‡πÄ‡∏ú‡πá‡∏î‡∏ô‡πâ‡∏≠‡∏¢', '‡πÄ‡∏ú‡πá‡∏î‡∏õ‡∏Å‡∏ï‡∏¥', '‡πÄ‡∏ú‡πá‡∏î‡∏Å‡∏•‡∏≤‡∏á', '‡πÄ‡∏ú‡πá‡∏î‡∏°‡∏≤‡∏Å'];

        let cart = [];
        let currentQueueNumber = 1;

        // Initialize queue number based on current date
        function initializeQueue() {
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('queueDate');
            const savedQueue = localStorage.getItem('currentQueue');
            
            if (savedDate === today && savedQueue) {
                currentQueueNumber = parseInt(savedQueue);
            } else {
                currentQueueNumber = 1;
                localStorage.setItem('queueDate', today);
            }
            
            document.getElementById('queueNumber').textContent = String(currentQueueNumber).padStart(3, '0');
        }

        // Generate menu items
        function generateMenuItems() {
            const container = document.getElementById('menuItems');
            container.innerHTML = '';

            menuItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md p-3 card-hover cursor-pointer touch-manipulation';
                card.innerHTML = `
                    <div class="text-center">
                        <div class="text-2xl sm:text-3xl mb-2">üçú</div>
                        <h3 class="text-sm sm:text-base font-semibold text-gray-800 leading-tight mb-1">${item.name}</h3>
                        <p class="text-lg sm:text-xl font-bold text-red-600 mb-2">${item.price}‡∏ø</p>
                        <div class="quantity-display-main font-semibold text-xs sm:text-sm text-gray-600" data-item-id="${item.id}">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 0</div>
                        
                        <!-- Hidden elements for tracking -->
                        <div style="display: none;">
                            <span class="quantity-display" data-item-id="${item.id}">0</span>
                            <div id="hidden-options-${item.id}"></div>
                        </div>
                    </div>
                `;
                
                // Add click event listener
                card.addEventListener('click', () => openOptionsPopup(item.id));
                container.appendChild(card);
            });

            // Add event listeners
            addEventListeners();
        }

        function addEventListeners() {
            // Quantity buttons
            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.addEventListener('click', handleQuantityChange);
            });

            // Extra options and spice level
            document.querySelectorAll('.extra-option, .spice-radio').forEach(input => {
                input.addEventListener('change', updateCart);
            });

            // Spice level visual feedback
            document.querySelectorAll('.spice-level').forEach(label => {
                label.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    const itemId = radio.dataset.itemId;
                    
                    // Remove active class from siblings
                    document.querySelectorAll(`input[name="spice-${itemId}"]`).forEach(r => {
                        r.closest('.spice-level').querySelector('div').classList.remove('border-red-500', 'bg-red-50');
                    });
                    
                    // Add active class to selected
                    this.querySelector('div').classList.add('border-red-500', 'bg-red-50');
                });
            });
        }

        let currentItemId = null;

        // Open options popup
        function openOptionsPopup(itemId) {
            currentItemId = itemId;
            const item = menuItems.find(i => i.id === itemId);
            
            // Set item info
            document.getElementById('popupItemName').textContent = item.name;
            document.getElementById('popupItemPrice').textContent = `${item.price}‡∏ø`;
            
            // Populate extra options
            const extraOptionsContainer = document.getElementById('popupExtraOptions');
            extraOptionsContainer.innerHTML = '';
            extraOptions.forEach(extra => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-3 cursor-pointer p-3 active:bg-gray-100 rounded touch-manipulation';
                label.innerHTML = `
                    <input type="checkbox" class="popup-extra-option w-5 h-5" data-extra-id="${extra.id}" data-price="${extra.price}">
                    <span class="text-sm">${extra.name} (+${extra.price}‡∏ø)</span>
                `;
                extraOptionsContainer.appendChild(label);
            });
            
            // Populate spice levels
            const spiceLevelsContainer = document.getElementById('popupSpiceLevels');
            spiceLevelsContainer.innerHTML = '';
            spiceLevels.forEach((level, index) => {
                const label = document.createElement('label');
                label.className = 'spice-level cursor-pointer touch-manipulation';
                label.innerHTML = `
                    <input type="radio" name="popup-spice" value="${level}" class="hidden popup-spice-radio">
                    <div class="text-center p-3 border-2 border-gray-200 rounded-lg active:border-red-300 transition-colors">
                        <div class="text-lg mb-1">${'üå∂Ô∏è'.repeat(index)}${index === 0 ? 'üòä' : ''}</div>
                        <div class="text-xs">${level}</div>
                    </div>
                `;
                spiceLevelsContainer.appendChild(label);
            });
            
            // Load current values
            loadCurrentValues(itemId);
            
            // Show popup
            document.getElementById('optionsPopup').classList.remove('hidden');
            document.getElementById('optionsPopup').classList.add('flex');
        }
        
        function loadCurrentValues(itemId) {
            // Load current quantity
            const currentQuantity = parseInt(document.querySelector(`[data-item-id="${itemId}"].quantity-display`).textContent) || 0;
            document.getElementById('popupQuantity').textContent = currentQuantity;
            
            // Load current extra options
            document.querySelectorAll(`[data-item-id="${itemId}"].extra-option:checked`).forEach(checkbox => {
                const extraId = checkbox.dataset.extraId;
                const popupCheckbox = document.querySelector(`[data-extra-id="${extraId}"].popup-extra-option`);
                if (popupCheckbox) popupCheckbox.checked = true;
            });
            
            // Load current spice level
            const currentSpice = document.querySelector(`input[name="spice-${itemId}"]:checked`);
            if (currentSpice) {
                const popupSpiceRadio = document.querySelector(`[value="${currentSpice.value}"].popup-spice-radio`);
                if (popupSpiceRadio) {
                    popupSpiceRadio.checked = true;
                    popupSpiceRadio.closest('.spice-level').querySelector('div').classList.add('border-red-500', 'bg-red-50');
                }
            }
        }

        function handleQuantityChange(e) {
            const action = e.target.dataset.action;
            const itemId = parseInt(e.target.dataset.itemId);
            const quantityDisplay = document.querySelector(`[data-item-id="${itemId}"].quantity-display`);
            const quantityDisplayMain = document.querySelector(`[data-item-id="${itemId}"].quantity-display-main`);
            let currentQuantity = parseInt(quantityDisplay.textContent);

            if (action === 'increase') {
                currentQuantity++;
            } else if (action === 'decrease' && currentQuantity > 0) {
                currentQuantity--;
            }

            quantityDisplay.textContent = currentQuantity;
            quantityDisplayMain.textContent = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${currentQuantity}`;
            updateCart();
        }

        function updateCart() {
            cart = [];

            menuItems.forEach(item => {
                const quantity = parseInt(document.querySelector(`[data-item-id="${item.id}"].quantity-display`).textContent);
                
                if (quantity > 0) {
                    const extras = [];
                    document.querySelectorAll(`[data-item-id="${item.id}"].extra-option:checked`).forEach(checkbox => {
                        const extraId = checkbox.dataset.extraId;
                        const extraPrice = parseInt(checkbox.dataset.price);
                        const extraName = extraOptions.find(e => e.id === extraId).name;
                        extras.push({ id: extraId, name: extraName, price: extraPrice });
                    });

                    const spiceLevel = document.querySelector(`input[name="spice-${item.id}"]:checked`)?.value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

                    cart.push({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        quantity: quantity,
                        extras: extras,
                        spiceLevel: spiceLevel
                    });
                }
            });

            updateOrderSummary();
        }

        function updateOrderSummary() {
            const summaryContainer = document.getElementById('orderSummary');
            const totalPriceElement = document.getElementById('totalPrice');

            if (cart.length === 0) {
                summaryContainer.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
                totalPriceElement.textContent = '0 ‡∏ö‡∏≤‡∏ó';
                return;
            }

            let totalPrice = 0;
            let summaryHTML = '';

            cart.forEach(item => {
                const extrasPrice = item.extras.reduce((sum, extra) => sum + (extra.price * item.quantity), 0);
                const itemTotal = (item.price * item.quantity) + extrasPrice;
                totalPrice += itemTotal;

                summaryHTML += `
                    <div class="border-b border-gray-100 pb-3 mb-3">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold">${item.name} (${item.price} ‡∏ö‡∏≤‡∏ó) x ${item.quantity}</h4>
                                <p class="text-sm text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ú‡πá‡∏î: ${item.spiceLevel}</p>
                                ${item.extras.length > 0 ? `
                                    <div class="text-sm text-gray-600 mt-1">
                                        ‡πÄ‡∏™‡∏£‡∏¥‡∏°: ${item.extras.map(e => `${e.name} (+${e.price})`).join(', ')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="text-right">
                                <span class="font-semibold text-red-600">${itemTotal} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            summaryContainer.innerHTML = summaryHTML;
            totalPriceElement.textContent = `${totalPrice} ‡∏ö‡∏≤‡∏ó`;
        }

        // Submit order
        document.getElementById('submitOrder').addEventListener('click', function() {
            const customerName = document.getElementById('customerName').value.trim();
            
            if (!customerName) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô');
                return;
            }

            if (cart.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }

            // Show success popup
            showSuccessPopup();
            
            // Send to Google Sheets (simulated)
            sendToGoogleSheets();
            
            // Update queue number
            currentQueueNumber++;
            if (currentQueueNumber > 999) currentQueueNumber = 1;
            localStorage.setItem('currentQueue', currentQueueNumber.toString());
            document.getElementById('queueNumber').textContent = String(currentQueueNumber).padStart(3, '0');
        });

        function showSuccessPopup() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerNote = document.getElementById('customerNote').value.trim();
            const totalPrice = document.getElementById('totalPrice').textContent;
            const queueNumber = String(currentQueueNumber).padStart(3, '0');

            document.getElementById('finalQueueNumber').textContent = queueNumber;
            document.getElementById('finalCustomerName').textContent = customerName;
            document.getElementById('finalTotalPrice').textContent = totalPrice;

            // Order details with prices
            let orderDetails = '<div class="space-y-3">';
            let itemNumber = 1;
            
            cart.forEach(item => {
                const basePrice = item.price * item.quantity;
                const extrasPrice = item.extras.reduce((sum, extra) => sum + (extra.price * item.quantity), 0);
                const itemTotal = basePrice + extrasPrice;
                
                orderDetails += `
                    <div class="bg-white rounded-lg p-3 border border-gray-200">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">${itemNumber}. ${item.name} (${item.price}‡∏ø)</h5>
                                <div class="text-sm text-gray-600">
                                    <div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${item.quantity} √ó ${item.price}‡∏ø = ${basePrice}‡∏ø</div>
                                    <div>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ú‡πá‡∏î: ${item.spiceLevel}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-red-600">${itemTotal}‡∏ø</div>
                            </div>
                        </div>
                        ${item.extras.length > 0 ? `
                            <div class="border-t pt-2 mt-2">
                                <div class="text-sm text-gray-600">
                                    <div class="font-medium mb-1">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°:</div>
                                    ${item.extras.map(extra => `
                                        <div class="flex justify-between">
                                            <span>‚Ä¢ ${extra.name}</span>
                                            <span>${extra.price}‡∏ø √ó ${item.quantity} = ${extra.price * item.quantity}‡∏ø</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
                itemNumber++;
            });
            
            orderDetails += '</div>';
            
            if (customerNote) {
                orderDetails += `
                    <div class="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                        <div class="font-medium text-yellow-800 mb-1">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</div>
                        <div class="text-yellow-700">${customerNote}</div>
                    </div>
                `;
            }
            
            document.getElementById('finalOrderDetails').innerHTML = orderDetails;

            document.getElementById('successPopup').classList.remove('hidden');
            document.getElementById('successPopup').classList.add('flex');
        }

        function sendToGoogleSheets() {
            const orderData = {
                queueNumber: String(currentQueueNumber).padStart(3, '0'),
                customerName: document.getElementById('customerName').value.trim(),
                customerNote: document.getElementById('customerNote').value.trim(),
                items: cart,
                totalPrice: document.getElementById('totalPrice').textContent,
                timestamp: new Date().toLocaleString('th-TH')
            };
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets
            fetch('https://script.google.com/macros/s/AKfycbwdk_oBZTxXWBG9NfW7JBBI5FU32HUx5eUwQc9Vav_OdjpxhMkjaOTAZnLt_A-KJypG/exec', {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(orderData)
            })
            .then(() => {
                console.log('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            })
            .catch(error => {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
            });
        }

        // Save image functionality
        document.getElementById('saveImage').addEventListener('click', function() {
            // Create a canvas to capture the popup content
            const popup = document.querySelector('#successPopup .bg-white');
            
            // Use html2canvas library (would need to be included)
            // For demo, we'll show an alert
            alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ html2canvas ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏£‡∏¥‡∏á');
        });

        // New order
        document.getElementById('newOrder').addEventListener('click', function() {
            // Reset form
            document.getElementById('customerName').value = '';
            document.getElementById('customerNote').value = '';
            
            // Reset quantities
            document.querySelectorAll('.quantity-display').forEach(display => {
                display.textContent = '0';
            });
            
            document.querySelectorAll('.quantity-display-main').forEach(display => {
                display.textContent = '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 0';
            });
            
            // Reset checkboxes and radio buttons
            document.querySelectorAll('.extra-option').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            document.querySelectorAll('.spice-radio').forEach(radio => {
                radio.checked = false;
            });
            
            // Reset spice level visual feedback
            document.querySelectorAll('.spice-level div').forEach(div => {
                div.classList.remove('border-red-500', 'bg-red-50');
            });
            
            // Remove hidden elements
            document.querySelectorAll('[id^="hidden-options-"]').forEach(el => {
                el.remove();
            });
            
            // Remove hidden quantity displays
            document.querySelectorAll('.quantity-display').forEach(el => {
                if (el.style.display === 'none' || el.closest('div[style*="display: none"]')) {
                    el.closest('div').remove();
                }
            });
            
            // Reset cart
            cart = [];
            updateOrderSummary();
            
            // Hide popup
            document.getElementById('successPopup').classList.add('hidden');
            document.getElementById('successPopup').classList.remove('flex');
        });

        // Popup event listeners
        document.getElementById('popupIncreaseBtn').addEventListener('click', function() {
            let quantity = parseInt(document.getElementById('popupQuantity').textContent);
            quantity++;
            document.getElementById('popupQuantity').textContent = quantity;
        });

        document.getElementById('popupDecreaseBtn').addEventListener('click', function() {
            let quantity = parseInt(document.getElementById('popupQuantity').textContent);
            if (quantity > 0) {
                quantity--;
                document.getElementById('popupQuantity').textContent = quantity;
            }
        });

        document.getElementById('confirmOptionsBtn').addEventListener('click', function() {
            if (currentItemId) {
                // Update main form with popup values
                const quantity = parseInt(document.getElementById('popupQuantity').textContent);
                
                // Update quantity displays
                const quantityDisplay = document.querySelector(`[data-item-id="${currentItemId}"].quantity-display`);
                const quantityDisplayMain = document.querySelector(`[data-item-id="${currentItemId}"].quantity-display-main`);
                
                if (!quantityDisplay) {
                    // Create hidden elements for tracking if they don't exist
                    const hiddenDiv = document.createElement('div');
                    hiddenDiv.style.display = 'none';
                    hiddenDiv.innerHTML = `
                        <span class="quantity-display" data-item-id="${currentItemId}">${quantity}</span>
                        <div id="hidden-options-${currentItemId}"></div>
                    `;
                    document.body.appendChild(hiddenDiv);
                } else {
                    quantityDisplay.textContent = quantity;
                }
                
                if (quantityDisplayMain) {
                    quantityDisplayMain.textContent = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${quantity}`;
                }
                
                // Update extra options
                const hiddenOptionsContainer = document.getElementById(`hidden-options-${currentItemId}`) || 
                    (() => {
                        const div = document.createElement('div');
                        div.id = `hidden-options-${currentItemId}`;
                        div.style.display = 'none';
                        document.body.appendChild(div);
                        return div;
                    })();
                
                hiddenOptionsContainer.innerHTML = '';
                
                // Add extra options
                document.querySelectorAll('.popup-extra-option:checked').forEach(checkbox => {
                    const extraId = checkbox.dataset.extraId;
                    const extraPrice = checkbox.dataset.price;
                    const hiddenCheckbox = document.createElement('input');
                    hiddenCheckbox.type = 'checkbox';
                    hiddenCheckbox.className = 'extra-option';
                    hiddenCheckbox.dataset.itemId = currentItemId;
                    hiddenCheckbox.dataset.extraId = extraId;
                    hiddenCheckbox.dataset.price = extraPrice;
                    hiddenCheckbox.checked = true;
                    hiddenOptionsContainer.appendChild(hiddenCheckbox);
                });
                
                // Add spice level
                const selectedSpice = document.querySelector('.popup-spice-radio:checked');
                if (selectedSpice) {
                    const hiddenRadio = document.createElement('input');
                    hiddenRadio.type = 'radio';
                    hiddenRadio.name = `spice-${currentItemId}`;
                    hiddenRadio.value = selectedSpice.value;
                    hiddenRadio.checked = true;
                    hiddenOptionsContainer.appendChild(hiddenRadio);
                }
                
                updateCart();
                closeOptionsPopup();
            }
        });

        document.getElementById('closeOptionsBtn').addEventListener('click', closeOptionsPopup);

        function closeOptionsPopup() {
            document.getElementById('optionsPopup').classList.add('hidden');
            document.getElementById('optionsPopup').classList.remove('flex');
            currentItemId = null;
        }

        // Popup spice level visual feedback
        document.addEventListener('click', function(e) {
            if (e.target.closest('.spice-level') && e.target.closest('#popupSpiceLevels')) {
                const spiceLevel = e.target.closest('.spice-level');
                const radio = spiceLevel.querySelector('.popup-spice-radio');
                
                // Remove active class from all popup spice levels
                document.querySelectorAll('#popupSpiceLevels .spice-level div').forEach(div => {
                    div.classList.remove('border-red-500', 'bg-red-50');
                });
                
                // Add active class to selected
                radio.checked = true;
                spiceLevel.querySelector('div').classList.add('border-red-500', 'bg-red-50');
            }
        });

        // Initialize app
        initializeQueue();
        generateMenuItems();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'988d61bb8475fd89',t:'MTc1OTUwNDM4OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
